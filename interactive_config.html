<head> <meta charset="UTF-8"> </head>
<h1> This is the fixture interactive config generator</h1>
<h2> Just fill out the form and then copy the config file at the bottom </h2>



<form>
    <label for="circuit_filepath_text">Filepath to circuit definition</label>
    <input type="text" id="circuit_filepath_text" oninput="circuit_filepath_fun()"/> <br>
    <br>

    <h3> Pins </h3>
    <div id="pin_container"></div>
    <br>
    <button type="button" id="add_pins" onclick="add_pin()">Add Pin</button>

</form>


<script type="text/javascript">
var pin_name_inc = 0;

function add_pin() {
    var pin_container = document.getElementById('pin_container');
    var pin_div = document.createElement('div')
    pin_id = 'pin' + String(pin_name_inc);
    pin_name_inc++;
    pin_div.id = pin_id;
    pin_container.appendChild(pin_div);

    pin_div.appendChild(document.createElement('br'));

    //var name_div = document.createElement('div');
    //var name_text = document.createElement('label');
    //name_text.innerHTML = 'Pin name: ';
    //var name_box = document.createElement('input');
    //name_box.type = 'text';
    //name_box.id = 'pin_name';
    //name_div.appendChild(name_text);
    //name_div.appendChild(name_box);
    //pin_div.appendChild(name_div);
    name_element = text('Pin name: ', pin_id + '_name');
    pin_div.appendChild(name_element);

    var electricaltype = radio(pin_id + 'electricaltype',
        {'voltage': [empty, empty],
         'current': [empty, empty]}
    );
    //pin_div.appendChild(label('Electrical type: ', electricaltype));
    pin_div.appendChild(electricaltype);


    var inout = radio(pin_id + 'inout',
        {'input': [add_pin_input, remove_pin_input],
         'output': [empty, empty]}
    );
    //pin_div.appendChild(label('Input or output? ', inout));
    pin_div.appendChild(inout);

}

function empty () {

}


function add_pin_input() {
    parent = this.parentElement.parentElement;
    div1 = document.createElement('div');
    div1.id = parent.id + '_input';
    div1.setAttribute('name', 'pin_input');
    parent.appendChild(div1);

    value_element = text('Value: ', div1.id + '_value');
    div1.appendChild(value_element);

    req_opt = radio(div1.id + '_req_opt',
        {'required': [empty, empty],
         'optional': [add_pin_optional, remove_pin_optional]}
    );
    div1.appendChild(req_opt);
}

function remove_pin_input() {
    parent = this.parentElement.parentElement;
    to_delete = parent.querySelector('div[name="pin_input"]');
    parent.removeChild(to_delete);

}

function add_pin_optional() {
    parent = this.parentElement.parentElement;
    div1 = document.createElement('div');
    div1.id = parent.id + '_optional';
    div1.setAttribute('name', 'pin_optional');
    parent.appendChild(div1);

    opt_type = radio(div1.id + 'opt_type',
        {'analog': [empty, empty],
         'quantized_analog': [empty, empty],
         'true_digital': [empty, empty]}
    );
    div1.appendChild(opt_type);
}

function remove_pin_optional() {
    parent = this.parentElement.parentElement;
    to_delete = parent.querySelector('div[name="pin_optional"]');
    parent.removeChild(to_delete);

}


function label(name, element) {
    label_element = document.createElement('label');
    label_element.innerHTML = name;
    label_element.for = element;
    div = document.createElement('div');
    div.appendChild(label_element);
    div.appendChild(element);
    return div;
}

function text(prompt, id) {
    var text_box = document.createElement('input');
    text_box.type = 'text';
    text_box.id = id;
    text_element = label(prompt, text_box);
    return text_element;
}

function radio(name, choices) {
    var div = document.createElement('div');
    var current_value = null;
    var input_objects = {}
    for (let choice in choices) {

        var input = document.createElement('input');
        input.type = 'radio';
        input.name = name;
        id = name + '_' + choice;
        input.id = id;
        input_objects[choice] = input;
        div.appendChild(input);

        var label = document.createElement('label');
        label.for = id;
        label.innerHTML = choice;
        div.appendChild(label);

        var span = document.createElement('span');
        span.id = 'radio_spacing';
        span.style = 'width:1em;display:inline-block;';
        div.appendChild(span);
    };

    // implement onselect and ondeselect
    for (let choice in choices) {

        function onclick() {
            if (current_value == choice) {
                return;
            }
            // deselect old
            if (current_value != null) {
                choices[current_value][1].call(input_objects[current_value]);
            }
            // select new
            choices[choice][0].call(input_objects[choice]);
            current_value = choice
        }

        input_objects[choice].onclick = onclick;
    }

    return div;
}

function dropdown(name, choices) {
    var select = document.createElement('select');
    select.name = name;
    select.id = name;

    choices.forEach(choice => {
        var option = document.createElement('option');
        option.value = choice;
        option.text = choice;
        select.appendChild(option);
    });

    return select;
}
</script>